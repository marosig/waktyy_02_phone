<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAKTY - Student Productivity App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
     * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --bg-dark: #0a0a0a;
    --bg-card: #1a1a1a;
    --bg-card-hover: #252525;
    --text-primary: #ffffff;
    --text-secondary: #a0a0a0;
    --accent-primary: #00d4aa;
    --accent-secondary: #6366f1;
    --accent-pink: #ec4899;
    --accent-orange: #f59e0b;
    --border: #333333;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
}

[data-theme="light"] {
    --bg-dark: #ffffff;
    --bg-card: #f8fafc;
    --bg-card-hover: #f1f5f9;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --border: #e2e8f0;
}

[data-theme="white"] {
    --bg-dark: #fefefe;
    --bg-card: #ffffff;
    --bg-card-hover: #f9fafb;
    --text-primary: #111827;
    --text-secondary: #6b7280;
    --border: #e5e7eb;
}

[data-theme="neon"] {
    --bg-dark: #0f0f23;
    --bg-card: #1a1a2e;
    --bg-card-hover: #16213e;
    --text-primary: #eee6ff;
    --text-secondary: #9d8df1;
    --accent-primary: #00ffff;
    --accent-secondary: #ff00ff;
    --border: #3d3d5c;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg-dark);
    color: var(--text-primary);
    min-height: 100vh;
    background-image: 
        radial-gradient(circle at 20% 80%, rgba(0, 212, 170, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(236, 72, 153, 0.05) 0%, transparent 50%);
    transition: all 0.3s ease;
}

.container {
    max-width: 460px;
    margin: 0 auto;
    padding: 0 15px;
    position: relative;
}

.page {
    display: none;
    animation: fadeIn 0.5s ease-in-out;
}

.page.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.03); }
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 60px 0 30px;
}

.page-title {
    font-size: 28px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.app-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 36px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: pulse 2s infinite ease-in-out;
    letter-spacing: 2px;
    text-transform: uppercase;
    text-shadow: 0 0 10px rgba(0, 212, 170, 0.5);
}

.theme-selector {
    display: flex;
    gap: 8px;
}

.theme-btn {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid var(--border);
    cursor: pointer;
    transition: all 0.3s ease;
}

.theme-btn.dark { background: #0a0a0a; }
.theme-btn.light { background: #ffffff; }
.theme-btn.white { background: #fefefe; }
.theme-btn.neon { background: linear-gradient(45deg, #00ffff, #ff00ff); }

.theme-btn.active {
    border-color: var(--accent-primary);
    transform: scale(1.1);
}

.card {
    background: var(--bg-card);
    border-radius: 18px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
    backdrop-filter: blur(8px);
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0, 212, 170, 0.1);
}

.stats-grid {
    display: flex;
    overflow-x: auto;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 10px;
    scrollbar-width: thin;
    scrollbar-color: var(--accent-primary) var(--bg-card);
}

.stats-grid::-webkit-scrollbar {
    height: 6px;
}

.stats-grid::-webkit-scrollbar-thumb {
    background: var(--accent-primary);
    border-radius: 10px;
}

.stat-card {
    background: var(--bg-card);
    border-radius: 18px;
    padding: 12px;
    text-align: center;
    border: 1px solid var(--border);
    backdrop-filter: blur(8px);
    transition: all 0.3s ease;
    min-width: 100px;
    cursor: pointer;
}

.stat-card:hover {
    transform: translateY(-5px);
    border-color: var(--accent-primary);
    box-shadow: 0 15px 40px rgba(0, 212, 170, 0.2);
}

.stat-icon {
    font-size: 24px;
    margin-bottom: 8px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.stat-number {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 5px;
    color: var(--text-primary);
}

.stat-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.task-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.task-item {
    background: var(--bg-card);
    border-radius: 18px;
    padding: 15px;
    border: 1px solid var(--border);
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.task-item.study::before { background: var(--accent-primary); }
.task-item.exercise::before { background: var(--accent-orange); }
.task-item.hobby::before { background: var(--accent-pink); }
.task-item.break::before { background: var(--warning); }
.task-item.free::before { background: var(--accent-secondary); }
.task-item.custom::before { background: var(--text-secondary); }

.task-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 18px 0 0 18px;
}

.task-item:hover::before {
    opacity: 1;
}

.task-item.completed {
    opacity: 0.7;
    background: var(--bg-card-hover);
}

.task-item.completed .task-title {
    text-decoration: line-through;
}

.task-item.completed::before {
    background: var(--success);
    opacity: 1;
}

.task-checkbox {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
    margin-top: 2px;
}

.task-checkbox.checked {
    background: var(--success);
    border-color: var(--success);
}

.task-checkbox.checked::after {
    content: '\f00c';
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    color: white;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
}

.task-content {
    flex: 1;
    overflow: hidden;
}

.task-title {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 4px;
    line-height: 1.3;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.task-meta {
    font-size: 13px;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.task-time {
    font-weight: 500;
}

.task-duration {
    background: rgba(0, 212, 170, 0.1);
    color: var(--accent-primary);
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 500;
}

.fa-icon {
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    font-size: 20px;
    margin-top: -2px;
}

.btn {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0, 212, 170, 0.4);
}

.btn:active:not(:disabled) {
    transform: translateY(0);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-secondary {
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border);
}

.btn-secondary:hover:not(:disabled) {
    border-color: var(--accent-primary);
    box-shadow: 0 5px 20px rgba(0, 212, 170, 0.2);
}

.btn-small {
    padding: 8px 16px;
    font-size: 14px;
    border-radius: 10px;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
}

.form-input {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: var(--bg-card);
    color: var(--text-primary);
    font-size: 15px;
    transition: all 0.3s ease;
}

.form-input:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
}

.form-select {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: var(--bg-card);
    color: var(--text-primary);
    font-size: 15px;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23a0a0a0'%3E%3Cpath d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
}

.quiz-container {
    max-width: 100%;
}

.quiz-progress {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 30px;
}

.progress-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--border);
    transition: all 0.3s ease;
}

.progress-dot.active {
    background: var(--accent-primary);
    transform: scale(1.2);
}

.progress-dot.completed {
    background: var(--success);
}

.quiz-step {
    display: none;
}

.quiz-step.active {
    display: block;
    animation: slideIn 0.5s ease-out;
}

.quiz-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
}

.schedule-timeline {
    position: relative;
}

.schedule-timeline::before {
    content: '';
    position: absolute;
    left: 35px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border);
}

.schedule-item {
    position: relative;
    margin-bottom: 15px;
    padding-left: 80px;
}

.schedule-time {
    position: absolute;
    left: 0;
    top: 0;
    width: 60px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary);
    text-align: right;
}

.schedule-dot {
    position: absolute;
    left: 26px;
    top: 8px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--accent-primary);
    border: 3px solid var(--bg-dark);
}

.navigation {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-card);
    border-radius: 25px 25px 0 0;
    padding: 12px;
    width: 100%;
    max-width: 460px;
    height: 80px;
    border: 2px solid var(--border);
    border-bottom: none;
    backdrop-filter: blur(8px);
    z-index: 1000;
}

.nav-items {
    display: flex;
    justify-content: space-around;
    align-items: center;
    gap: 12px;
    height: 100%;
}

.nav-item {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 8px;
    border-radius: 14px;
    min-width: 48px;
}

.nav-item.active {
    background: rgba(0, 212, 170, 0.1);
}

.nav-icon {
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    font-size: 32px;
    transition: all 0.3s ease;
}

.nav-item.active .nav-icon {
    color: var(--accent-primary);
    transform: scale(1.1);
}

.content {
    padding-bottom: 120px;
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 15px 20px;
    max-width: 300px;
    z-index: 1001;
    transform: translateX(100%);
    opacity: 0;
    transition: all 0.3s ease;
}

.notification.show {
    transform: translateX(0);
    opacity: 1;
}

.notification.success {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.1);
}

.notification.error {
    border-color: var(--danger);
    background: rgba(239, 68, 68, 0.1);
}

.empty-state {
    text-align: center;
    padding: 30px 15px;
    color: var(--text-secondary);
}

.empty-icon {
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    font-size: 40px;
    margin-bottom: 12px;
    opacity: 0.5;
}

.empty-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.empty-description {
    font-size: 13px;
    line-height: 1.5;
}

.profile-section {
    text-align: center;
    margin-bottom: 20px;
}

.profile-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    font-size: 36px;
    margin: 0 auto 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.profile-avatar:hover {
    transform: scale(1.1);
    box-shadow: 0 10px 30px rgba(0, 212, 170, 0.3);
}

.profile-name {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 5px;
}

.profile-level {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 12px;
}

.profile-xp {
    background: var(--bg-card);
    border-radius: 15px;
    padding: 15px;
    border: 1px solid var(--border);
}

.xp-bar {
    width: 100%;
    height: 8px;
    background: var(--border);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 10px;
}

.xp-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    transition: width 0.5s ease;
}

.welcome-banner {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius: 18px;
    padding: 20px;
    margin-bottom: 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
    animation: fadeIn 0.7s ease-in-out;
}

.welcome-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
    opacity: 0.3;
}

.welcome-avatar-container {
    position: relative;
    display: inline-block;
    margin-bottom: 12px;
}

.progress-ring {
    position: absolute;
    top: -8px;
    left: -8px;
    width: 96px;
    height: 96px;
}

.progress-ring circle {
    fill: none;
    stroke: var(--success);
    stroke-width: 6;
    stroke-linecap: round;
    transform: rotate(-90deg);
    transform-origin: 50% 50%;
    transition: stroke-dashoffset 0.5s ease;
}

.welcome-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin-bottom: 8px;
}

.welcome-quote {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.9);
    font-style: italic;
}

.schedule-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.schedule-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
}

.quick-add-form {
    display: none;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border);
}

.quick-add-form.active {
    display: block;
    animation: slideIn 0.3s ease-out;
}

@media (max-width: 480px) {
    .container {
        padding: 0 10px;
    }
    .welcome-banner {
        padding: 15px;
    }
    .welcome-title {
        font-size: 20px;
    }
    .welcome-quote {
        font-size: 13px;
    }
    .stats-grid {
        gap: 10px;
    }
    .stat-card {
        min-width: 90px;
        padding: 10px;
    }
    .stat-number {
        font-size: 16px;
    }
    .navigation {
        padding: 8px;
    }
    .nav-item {
        min-width: 40px;
        padding: 6px;
    }
    .nav-icon {
        font-size: 28px;
    }
}

.text-center { text-align: center; }
.mb-20 { margin-bottom: 20px; }
.mb-30 { margin-bottom: 30px; }
.mt-20 { margin-top: 20px; }
.hidden { display: none; }
.flex { display: flex; }
.flex-center { display: flex; align-items: center; justify-content: center; }
.gap-10 { gap: 10px; }
.gap-15 { gap: 15px; }
    </style>
</head>
<body data-theme="dark">
    <div class="container">
        <div class="content">
            <!-- HOME PAGE -->
            <div id="home" class="page active"tabindex="0">
                <div class="header">
                    <div class="app-title">WAKTY</div>
                </div>
                <div class="welcome-banner">
                    <div class="welcome-avatar-container">
                        <div class="profile-avatar" id="welcomeAvatar" role="button" aria-label="Go to profile" tabindex="0">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <svg class="progress-ring">
                            <circle cx="48" cy="48" r="42" stroke-dasharray="264" stroke-dashoffset="0" id="progressRing"></circle>
                        </svg>
                    </div>
                    <div class="welcome-title" id="welcomeName">Hello, Student!</div>
                    <div class="welcome-quote">"Crush your goals today!"</div>
                </div>

                <div class="stats-grid" role="region" aria-label="Progress statistics">
                    <div class="stat-card" role="button" aria-label="View day streak" tabindex="0">
                        <div class="stat-icon"><i class="fas fa-fire"></i></div>
                        <div class="stat-number" id="dayStreak">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="stat-card" role="button" aria-label="View tasks completed today" tabindex="0">
                        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-number" id="tasksCompletedToday">0</div>
                        <div class="stat-label">Tasks Done</div>
                    </div>
                    <div class="stat-card" role="button" aria-label="View study hours today" tabindex="0">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-number" id="studyTimeToday">0</div>
                        <div class="stat-label">Study Hours</div>
                    </div>
                </div>

                <div class="card">
                    <div class="schedule-header">
                        <h3 class="schedule-title">Today's Schedule</h3>
                        <button class="btn btn-small" aria-label="Toggle quick add task form">
                            <i class="fas fa-plus"></i> Add Task
                        </button>
                    </div>
                    <div class="quick-add-form" id="quickAddForm">
                        <div class="form-group">
                            <label class="form-label" for="quickTaskTime">Time</label>
                            <input type="time" class="form-input" id="quickTaskTime" required aria-required="true">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="quickTaskText">Task Description</label>
                            <input type="text" class="form-input" id="quickTaskText" placeholder="Enter task..." required aria-required="true">
                        </div>
                        <div class="flex gap-10">
                            <button class="btn btn-small" aria-label="Add task">Add</button>
                            <button class="btn btn-small btn-secondary" aria-label="Cancel adding task">Cancel</button>
                        </div>
                    </div>
                    <div id="todaySchedule" class="schedule-timeline"></div>
                </div>
            </div>

            <!-- SCHEDULER PAGE -->
            <div id="scheduler" class="page"tabindex="0">
                <div class="header">
                    <div class="page-title">Create Schedule</div>
                </div>

                <div class="quiz-container">
                    <div class="quiz-progress" id="quizProgress" role="region" aria-label="Quiz progress"></div>
                    
                    <div class="card">
                        <div id="quizSteps" role="form" aria-label="Schedule creation form"></div>
                        
                        <div class="quiz-navigation">
                            <button class="btn btn-secondary" id="prevBtn" style="display: none;" aria-label="Previous question">Back</button>
                            <button class="btn" id="nextBtn" aria-label="Next question or finish">Next</button>
                        </div>
                    </div>
                </div>

                <div id="schedulePreview" class="card hidden">
                    <h3 style="margin-bottom: 20px;">Your Generated Schedule</h3>
                    <div id="scheduleDisplay" class="schedule-timeline"></div>
                    <button class="btn mt-20" aria-label="Save schedule">Save Schedule</button>
                </div>
            </div>

            <!-- TASKS PAGE -->
            <div id="tasks" class="page">
                <div class="header">
                    <div class="page-title">Tasks</div>
                </div>

                <div class="card">
                    <div id="tasksList" class="task-list" role="list" aria-label="Task list"></div>
                </div>
            </div>

            <!-- REMINDERS PAGE -->
            <div id="reminders" class="page"tabindex="0">
                <div class="header">
                    <div class="page-title">Reminders</div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Add Custom Reminder</h3>
                    <div class="form-group">
                        <label class="form-label" for="reminderTime">Time</label>
                        <input type="time" class="form-input" id="reminderTime" required aria-required="true">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="reminderText">Task Description</label>
                        <input type="text" class="form-input" id="reminderText" placeholder="What do you need to remember?" required aria-required="true">
                    </div>
                    <button class="btn" aria-label="Add reminder">Add Reminder</button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Your Reminders</h3>
                    <div id="remindersList" class="task-list" role="list" aria-label="Reminders list"></div>
                </div>
            </div>

            <!-- PROGRESS PAGE -->
            <div id="progress" class="page"tabindex="0">
                <div class="header">
                    <div class="page-title">Progress</div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalStreak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalTasksCompleted">0</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalXP">0</div>
                        <div class="stat-label">Total XP</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Completed Tasks</h3>
                    <div id="completedTasksList" class="task-list" role="list" aria-label="Completed tasks list"></div>
                </div>
            </div>

            <!-- PROFILE PAGE -->
            <div id="profile" class="page"tabindex="0">
                <div class="header">
                    <div class="page-title">Profile</div>
                    <div class="theme-selector" role="group" aria-label="Theme selector">
                        <div class="theme-btn dark active" data-theme="dark" role="button" aria-label="Select dark theme" tabindex="0"></div>
                        <div class="theme-btn light" data-theme="light" role="button" aria-label="Select light theme" tabindex="0"></div>
                        <div class="theme-btn white" data-theme="white" role="button" aria-label="Select white theme" tabindex="0"></div>
                        <div class="theme-btn neon" data-theme="neon" role="button" aria-label="Select neon theme" tabindex="0"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="profile-section">
                        <div class="profile-avatar" id="profileAvatar" role="button" aria-label="Change avatar" tabindex="0"><i class="fas fa-bullseye"></i></div>
                        <div class="profile-name" id="profileName">Student</div>
                        <div class="profile-level">
                            Level <span id="profileLevel">1</span> â€¢ <span id="profileXP">0</span> XP
                        </div>
                        <div class="profile-xp">
                            <div>XP Progress</div>
                            <div class="xp-bar">
                                <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                                <span id="currentXP">0</span> / <span id="nextLevelXP">100</span> XP
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Your Hobbies</h3>
                    <div class="form-group">
                        <label class="form-label" for="hobbiesInput">Add Hobbies (comma-separated)</label>
                        <input type="text" class="form-input" id="hobbiesInput" placeholder="Reading, Gaming, Music..." aria-required="true">
                    </div>
                    <button class="btn" aria-label="Save hobbies">Save Hobbies</button>
                    
                    <div id="hobbiesList" class="mt-20" role="list" aria-label="Hobbies list"></div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation" role="navigation" aria-label="Main navigation">
            <div class="nav-items">
                <div class="nav-item active" role="button" aria-label="Home" aria-current="page" tabindex="0">
                    <div class="nav-icon"><i class="fas fa-home"></i></div>
                </div>
                <div class="nav-item" role="button" aria-label="Scheduler" tabindex="0">
                    <div class="nav-icon"><i class="fas fa-calendar"></i></div>
                </div>
                <div class="nav-item" role="button" aria-label="Tasks" tabindex="0">
                    <div class="nav-icon"><i class="fas fa-check-square"></i></div>
                </div>
                <div class="nav-item" role="button" aria-label="Reminders" tabindex="0">
                    <div class="nav-icon"><i class="fas fa-bell"></i></div>
                </div>
                <div class="nav-item" role="button" aria-label="Progress" tabindex="0">
                    <div class="nav-icon"><i class="fas fa-chart-bar"></i></div>
                </div>
                <div class="nav-item" role="button" aria-label="Profile" tabindex="0">
                    <div class="nav-icon"><i class="fas fa-user"></i></div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification" role="alert" aria-live="assertive"></div>
    <script>
const defaultState = {
    user: { name: "Student", avatar: "fas fa-bullseye", level: 1, xp: 0, streak: 0, hobbies: [] },
    theme: "dark",
    schedule: [],
    tasks: [],
    reminders: [],
    completedTasks: [],
    stats: { tasksCompletedToday: 0, studyTimeToday: 0, lastReviewDate: null },
    quizAnswers: {},
    currentQuizStep: 0
};
let state = { ...defaultState };

const quizSteps = [
    { id: "name", question: "What's your name?", type: "text", required: true },
    { id: "timePreference", question: "Are you a morning person, night owl, or both?", type: "select", options: ["Morning", "Night", "Both"], required: true },
    { id: "schoolStart", question: "What time does your school start?", type: "time", required: true },
    { id: "schoolEnd", question: "What time does your school end?", type: "time", required: true },
    { id: "wakeUp", question: "What time do you wake up?", type: "time", required: true },
    { id: "bedtime", question: "What time do you go to bed?", type: "time", required: true },
    { id: "studyIntensity", question: "What's your study intensity?", type: "select", options: ["Chill", "Balanced", "Intense"], required: true },
    { id: "subjects", question: "What subjects are you studying? (comma-separated)", type: "text", required: true },
    { id: "exerciseType", question: "What type of exercise do you do?", type: "select", options: ["Running", "Yoga", "Gym", "Other"], required: false },
    { id: "exerciseDuration", question: "How long do you exercise? (minutes, min 30)", type: "number", min: 30, required: false },
    { id: "hobbies", question: "What are your hobbies? (comma-separated)", type: "text", required: false },
    { id: "hobbyDuration", question: "How long for hobbies? (minutes, min 60)", type: "number", min: 60, required: false },
    { id: "breakActivity", question: "What's your preferred break activity?", type: "select", options: ["Snack", "Nap", "Walk", "Other"], required: false },
    { id: "freeTimeActivity", question: "What do you do in your free time?", type: "select", options: ["Reading", "Netflix", "Gaming", "Other"], required: false }
];

function sanitizeHTML(str) {
    if (!str) return "";
    const div = document.createElement("div");
    div.textContent = str;
    return div.innerHTML.replace(/[<>]/g, "");
}

function formatTime(date) {
    if (!(date instanceof Date) || isNaN(date)) return "00:00";
    return date.toTimeString().slice(0, 5);
}

function parseTime(timeStr) {
    if (!timeStr || !/^\d{2}:\d{2}$/.test(timeStr)) return null;
    const [hours, minutes] = timeStr.split(":").map(Number);
    if (isNaN(hours) || isNaN(minutes) || hours > 23 || minutes > 59) return null;
    const date = new Date();
    date.setHours(hours, minutes, 0, 0);
    return date;
}

function addMinutes(time, minutes) {
    const date = parseTime(time);
    if (!date) {
        showNotification("Invalid time calculation!", "error");
        return time;
    }
    date.setMinutes(date.getMinutes() + minutes);
    return formatTime(date);
}

function showNotification(message, type = "success") {
    const notification = document.getElementById("notification");
    if (!notification) return;
    clearTimeout(notification.timeout);
    notification.textContent = sanitizeHTML(message);
    notification.className = `notification ${type} show`;
    notification.setAttribute("aria-label", `${type}: ${message}`);
    notification.timeout = setTimeout(() => {
        notification.className = "notification";
    }, 3000);
}

function saveState() {
    try {
        if (typeof localStorage !== 'undefined') {
            localStorage.setItem("studyFlowState", JSON.stringify(state));
        }
    } catch (e) {
        showNotification("Failed to save data. Storage may be unavailable.", "error");
    }
}

function loadState() {
    try {
        if (typeof localStorage !== 'undefined') {
            const savedState = localStorage.getItem("studyFlowState");
            if (savedState) {
                state = { ...defaultState, ...JSON.parse(savedState) };
                applyTheme();
                updateUI();
            }
        }
    } catch (e) {
        showNotification("Failed to load data. Starting with default settings.", "error");
    }
}

function resetDaily() {
    const today = new Date().toDateString();
    if (state.stats.lastReviewDate !== today) {
        console.log("Resetting daily stats for:", today);
        state.stats.tasksCompletedToday = 0;
        state.stats.studyTimeToday = 0;
        state.stats.lastReviewDate = today;
        saveState();
        updateUI();
    }
}

function applyTheme() {
    console.log("Applying theme:", state.theme);
    document.body.setAttribute("data-theme", state.theme);
    document.querySelectorAll(".theme-btn").forEach(btn => {
        btn.classList.toggle("active", btn.getAttribute("data-theme") === state.theme);
        btn.setAttribute("aria-pressed", btn.getAttribute("data-theme") === state.theme);
    });
}

function initializeThemeSelector() {
    document.querySelectorAll(".theme-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            state.theme = btn.getAttribute("data-theme");
            applyTheme();
            saveState();
            showNotification(`Theme changed to ${state.theme}!`);
        });
        btn.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                btn.click();
            }
        });
    });
}

function navigateTo(pageId) {
    console.log("Navigating to:", pageId);
    document.querySelectorAll(".page").forEach(page => page.classList.remove("active"));
    const page = document.getElementById(pageId);
    if (page) {
        page.classList.add("active");
        page.setAttribute("tabindex", "0");
        page.focus();
    }
    document.querySelectorAll(".nav-item").forEach(item => {
        const isActive = item.getAttribute("data-page") === pageId;
        item.classList.toggle("active", isActive);
        item.setAttribute("aria-current", isActive ? "page" : "false");
    });
    resetDaily();
    updateUI();
}

function initializeNavigation() {
    const pages = ["home", "scheduler", "tasks", "reminders", "progress", "profile"];
    document.querySelectorAll(".nav-item").forEach((item, index) => {
        console.log(`Attaching listener to nav-item ${index}`);
        item.setAttribute("data-page", pages[index]);
        item.addEventListener("click", () => navigateTo(pages[index]));
        item.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                navigateTo(pages[index]);
            }
        });
    });
}

function validateStep(stepIndex) {
    const step = quizSteps[stepIndex];
    const input = document.getElementById(step.id);
    if (!input) return false;
    const value = input.value.trim();

    if (step.required && !value) {
        showNotification(`${step.question} is required!`, "error");
        return false;
    }

    if (step.type === "number" && value && parseInt(value) < step.min) {
        showNotification(`Minimum value for ${step.question} is ${step.min}!`, "error");
        return false;
    }

    if (step.id === "schoolEnd" && state.quizAnswers.schoolStart && value) {
        const start = parseTime(state.quizAnswers.schoolStart);
        const end = parseTime(value);
        if (start && end && end <= start) {
            showNotification("School end time must be after start time!", "error");
            return false;
        }
    }

    if (step.id === "bedtime" && state.quizAnswers.wakeUp && value) {
        const wakeUp = parseTime(state.quizAnswers.wakeUp);
        const bedtime = parseTime(value);
        if (wakeUp && bedtime) {
            let wakeUpMinutes = wakeUp.getHours() * 60 + wakeUp.getMinutes();
            let bedtimeMinutes = bedtime.getHours() * 60 + bedtime.getMinutes();
            if (bedtimeMinutes < wakeUpMinutes) bedtimeMinutes += 24 * 60;
            if (bedtimeMinutes <= wakeUpMinutes) {
                showNotification("Bedtime must be after wake-up time!", "error");
                return false;
            }
        }
    }

    return true;
}

function renderQuiz() {
    console.log("Rendering quiz step:", state.currentQuizStep);
    const quizStepsContainer = document.getElementById("quizSteps");
    if (!quizStepsContainer) return;
    quizStepsContainer.innerHTML = "";
    const fragment = document.createDocumentFragment();

    quizSteps.forEach((step, index) => {
        const stepElement = document.createElement("div");
        stepElement.className = `quiz-step ${index === state.currentQuizStep ? 'active' : ''}`;
        stepElement.setAttribute("data-step", index);
        stepElement.setAttribute("role", "group");
        stepElement.setAttribute("aria-label", step.question);
        stepElement.innerHTML = `
            <div class="form-group">
                <label class="form-label" for="${step.id}">${sanitizeHTML(step.question)}</label>
                ${step.type === "text" ? `<input type="text" class="form-input" id="${step.id}" value="${sanitizeHTML(state.quizAnswers[step.id] || '')}" ${step.required ? 'required' : ''} aria-required="${step.required}" aria-label="${step.question}">` :
                 step.type === "number" ? `<input type="number" class="form-input" id="${step.id}" value="${sanitizeHTML(state.quizAnswers[step.id] || '')}" min="${step.min || 0}" ${step.required ? 'required' : ''} aria-required="${step.required}" aria-label="${step.question}">` :
                 step.type === "time" ? `<input type="time" class="form-input" id="${step.id}" value="${sanitizeHTML(state.quizAnswers[step.id] || '')}" ${step.required ? 'required' : ''} aria-required="${step.required}" aria-label="${step.question}">` :
                 `<select class="form-select" id="${step.id}" ${step.required ? 'required' : ''} aria-required="${step.required}" aria-label="${step.question}">
                    <option value="">Select...</option>
                    ${step.options.map(opt => `<option value="${opt}" ${state.quizAnswers[step.id] === opt ? 'selected' : ''}>${sanitizeHTML(opt)}</option>`).join('')}
                  </select>`}
            </div>
        `;
        fragment.appendChild(stepElement);
    });
    quizStepsContainer.appendChild(fragment);

    const quizProgress = document.getElementById("quizProgress");
    if (quizProgress) {
        quizProgress.innerHTML = quizSteps.map((_, index) => `
            <div class="progress-dot ${index === state.currentQuizStep ? 'active' : index < state.currentQuizStep ? 'completed' : ''}" role="status" aria-label="Question ${index + 1} ${index === state.currentQuizStep ? 'active' : index < state.currentQuizStep ? 'completed' : ''}"></div>
        `).join('');
    }

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    if (prevBtn && nextBtn) {
        prevBtn.style.display = state.currentQuizStep === 0 ? "none" : "inline-flex";
        nextBtn.textContent = state.currentQuizStep === quizSteps.length - 1 ? "Finish" : "Next";
        nextBtn.disabled = !validateStep(state.currentQuizStep);
    }

    const input = document.getElementById(quizSteps[state.currentQuizStep].id);
    if (input) {
        input.addEventListener("input", () => {
            nextBtn.disabled = !validateStep(state.currentQuizStep);
        });
        input.focus();
    }
}

function prevStep() {
    if (state.currentQuizStep > 0) {
        state.currentQuizStep--;
        renderQuiz();
    }
}

function nextStep() {
    const currentStep = quizSteps[state.currentQuizStep];
    const input = document.getElementById(currentStep.id);
    if (!input) return;
    state.quizAnswers[currentStep.id] = input.value.trim();

    if (!validateStep(state.currentQuizStep)) return;

    if (state.currentQuizStep < quizSteps.length - 1) {
        state.currentQuizStep++;
        renderQuiz();
    } else {
        generateSchedule();
        const quizStepsContainer = document.getElementById("quizSteps");
        const quizProgress = document.getElementById("quizProgress");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        if (quizStepsContainer) quizStepsContainer.classList.add("hidden");
        if (quizProgress) quizProgress.classList.add("hidden");
        if (prevBtn) prevBtn.style.display = "none";
        if (nextBtn) nextBtn.style.display = "none";
        const schedulePreview = document.getElementById("schedulePreview");
        if (schedulePreview) schedulePreview.classList.remove("hidden");
    }
}

function generateSchedule() {
    console.log("Generating schedule with answers:", state.quizAnswers);
    const { wakeUp, bedtime, schoolStart, schoolEnd, subjects, studyIntensity, exerciseType, exerciseDuration, hobbies, hobbyDuration, breakActivity, freeTimeActivity, timePreference } = state.quizAnswers;
    if (!wakeUp || !bedtime) {
        showNotification("Please provide wake-up and bedtime!", "error");
        return;
    }
    state.schedule = [];
    let currentTime = wakeUp;
    const bedtimeDate = parseTime(bedtime) || new Date().setHours(23, 59, 0, 0);
    const bedtimeMinutes = bedtimeDate.getHours() * 60 + bedtimeDate.getMinutes();

    const addTask = (title, description, duration, iconClass) => {
        const parsedTime = parseTime(currentTime);
        if (!parsedTime) return false;
        let currentMinutes = parsedTime.getHours() * 60 + parsedTime.getMinutes();
        if (currentMinutes + duration > bedtimeMinutes) {
            console.log(`Skipping task "${title}" as it exceeds bedtime`);
            return false;
        }
        const taskId = `${currentTime}-${title}-${Date.now()}`;
        state.schedule.push({ id: taskId, time: currentTime, title, description, duration, iconClass, completed: false });
        currentTime = addMinutes(currentTime, duration);
        return true;
    };

    addTask("Wake Up", "Start your day! ðŸŒž", 0, "fas fa-sun");
    addTask("Morning Routine", "Get ready for the day ðŸª¥", 30, "fas fa-tooth");

    if ((timePreference === "Morning" || timePreference === "Both") && exerciseType && exerciseDuration) {
        addTask(`Exercise: ${exerciseType}`, `Time for ${exerciseType.toLowerCase()} ðŸ’ª`, parseInt(exerciseDuration), "fas fa-dumbbell");
    }

    if (schoolStart && parseTime(currentTime) < parseTime(schoolStart)) {
        addTask("Free Time", freeTimeActivity || "Relax ðŸŽ‰", 45, "fas fa-party-horn");
        currentTime = schoolStart;
    }

    if (schoolStart && schoolEnd) {
        const start = parseTime(schoolStart);
        const end = parseTime(schoolEnd);
        if (start && end) {
            const schoolDuration = Math.round((end - start) / 60000);
            addTask("School", "Attend classes ðŸ“š", schoolDuration, "fas fa-school");
            currentTime = schoolEnd;
        }
    }

    addTask("Lunch Break", "Enjoy your meal ðŸ½ï¸", 45, "fas fa-utensils");

    if (subjects) {
        const subjectsList = subjects.split(",").map(s => s.trim()).filter(s => s);
        const studyDuration = studyIntensity === "Chill" ? 30 : studyIntensity === "Balanced" ? 45 : 60;
        subjectsList.forEach(subject => {
            if (!addTask(`Study: ${subject}`, `Focus on ${subject} ðŸ“–`, studyDuration, "fas fa-book")) return;
            addTask(breakActivity || "Break", "Take a short break â˜•", 10, "fas fa-coffee");
        });
    }

    if ((timePreference === "Night" || timePreference === "Both") && exerciseType && exerciseDuration) {
        addTask(`Exercise: ${exerciseType}`, `Time for ${exerciseType.toLowerCase()} ðŸ’ª`, parseInt(exerciseDuration), "fas fa-dumbbell");
    }

    if (hobbies && hobbyDuration) {
        const hobbiesList = hobbies.split(",").map(h => h.trim()).filter(h => h);
        addTask("Hobbies", `Enjoy ${hobbiesList.join(", ")} ðŸŽ¨`, parseInt(hobbyDuration), "fas fa-paint-brush");
    }

    addTask("Free Time", freeTimeActivity || "Relax ðŸŽ‰", 45, "fas fa-party-horn");
    addTask("Bedtime", "Get some rest ðŸ˜´", 0, "fas fa-bed");

    state.schedule.sort((a, b) => {
        const timeA = parseTime(a.time) || new Date(0);
        const timeB = parseTime(b.time) || new Date(0);
        return timeA - timeB;
    });
    renderSchedule();
}

function renderSchedule() {
    console.log("Rendering schedule:", state.schedule);
    const scheduleDisplay = document.getElementById("scheduleDisplay");
    if (!scheduleDisplay) return;
    requestAnimationFrame(() => {
        scheduleDisplay.innerHTML = "";
        const fragment = document.createDocumentFragment();
        state.schedule.forEach((item, index) => {
            const scheduleItem = document.createElement("div");
            scheduleItem.className = "schedule-item";
            scheduleItem.setAttribute("role", "listitem");
            scheduleItem.setAttribute("aria-label", `Schedule item: ${item.title}`);
            scheduleItem.innerHTML = `
                <div class="schedule-time">${sanitizeHTML(item.time)}</div>
                <div class="schedule-dot"></div>
                <div class="task-item ${item.completed ? 'completed' : ''} ${item.type || ''}">
                    <div class="task-checkbox ${item.completed ? 'checked' : ''}" role="checkbox" aria-checked="${item.completed}" aria-label="Toggle task completion" tabindex="0"></div>
                    <div class="task-content">
                        <div class="task-title">${sanitizeHTML(item.title)}</div>
                        <div class="task-meta">
                            <span class="task-time">${sanitizeHTML(item.time)}</span>
                            <span class="task-duration">${item.duration} min</span>
                            <span class="fa-icon"><i class="${sanitizeHTML(item.iconClass)}"></i></span>
                        </div>
                        <div>${sanitizeHTML(item.description)}</div>
                    </div>
                </div>
            `;
            fragment.appendChild(scheduleItem);
        });
        scheduleDisplay.appendChild(fragment);
        scheduleDisplay.querySelectorAll(".task-checkbox").forEach((checkbox, i) => {
            checkbox.addEventListener("click", () => toggleTask(state.schedule[i].id));
            checkbox.addEventListener("keydown", (e) => {
                if (e.key === "Enter" || e.key === " ") {
                    e.preventDefault();
                    toggleTask(state.schedule[i].id);
                }
            });
        });
    });
}

function saveSchedule() {
    state.tasks = state.schedule.map(item => ({ ...item, type: inferTaskType(item.title) }));
    state.reminders = state.tasks.map(task => ({ ...task, id: `${task.time}-${task.title}-${Date.now()}` }));
    state.user.hobbies = state.quizAnswers.hobbies ? state.quizAnswers.hobbies.split(",").map(h => h.trim()).filter(h => h) : [];
    state.user.name = state.quizAnswers.name || "Student";
    state.currentQuizStep = 0;
    state.quizAnswers = {};
    saveState();
    showNotification("Schedule saved successfully! ðŸ“…");
    navigateTo("home");
}

function inferTaskType(title) {
    if (!title) return "custom";
    title = title.toLowerCase();
    if (title.includes("study")) return "study";
    if (title.includes("exercise")) return "exercise";
    if (title.includes("hobbies")) return "hobby";
    if (title.includes("break") || title.includes("lunch")) return "break";
    if (title.includes("free time")) return "free";
    return "custom";
}

function toggleTask(taskId) {
    console.log("Toggling task:", taskId);
    const task = state.tasks.find(t => t.id === taskId);
    const reminder = state.reminders.find(r => r.id === taskId);
    const scheduleItem = state.schedule.find(s => s.id === taskId);

    if (task && scheduleItem) {
        task.completed = !task.completed;
        scheduleItem.completed = task.completed;
        if (reminder) reminder.completed = task.completed;

        if (task.completed) {
            state.stats.tasksCompletedToday++;
            if (task.type === "study") state.stats.studyTimeToday += task.duration / 60;
            state.user.xp += 10;
            state.completedTasks.push({ ...task, completionDate: new Date().toDateString() });
            if (state.completedTasks.length > 50) state.completedTasks.shift();
            if (state.tasks.every(t => t.completed)) {
                state.user.streak++;
                state.stats.tasksCompletedToday = 0;
                state.stats.studyTimeToday = 0;
                state.tasks = [];
                state.schedule = [];
                state.reminders = [];
                state.quizAnswers = {};
                state.currentQuizStep = 0;
                showNotification("All tasks completed! Streak increased! Create a new schedule! ðŸŽ‰");
                navigateTo("scheduler");
            } else {
                showNotification("Task completed! +10 XP âœ…");
            }
        } else {
            state.stats.tasksCompletedToday = Math.max(0, state.stats.tasksCompletedToday - 1);
            if (task.type === "study") state.stats.studyTimeToday = Math.max(0, state.stats.studyTimeToday - task.duration / 60);
            state.user.xp = Math.max(0, state.user.xp - 10);
            state.completedTasks = state.completedTasks.filter(t => t.id !== taskId);
            showNotification("Task unmarked. ðŸ”„");
        }

        state.user.level = Math.floor(state.user.xp / 100) + 1;
        if (state.user.level > 1 && state.user.xp % 100 === 0) {
            showNotification(`Level up! You are now Level ${state.user.level}! ðŸ†`);
        }
        saveState();
        updateUI();
    } else {
        showNotification("Task not found!", "error");
    }
}

function deleteTask(taskId) {
    state.tasks = state.tasks.filter(t => t.id !== taskId);
    state.schedule = state.schedule.filter(s => s.id !== taskId);
    state.reminders = state.reminders.filter(r => r.id !== taskId);
    saveState();
    showNotification("Task deleted! ðŸ—‘ï¸");
    updateUI();
}

function renderTasks() {
    console.log("Rendering tasks:", state.tasks);
    const tasksList = document.getElementById("tasksList");
    if (!tasksList) return;
    requestAnimationFrame(() => {
        tasksList.innerHTML = "";
        const fragment = document.createDocumentFragment();
        if (state.tasks.length) {
            state.tasks.forEach((task, index) => {
                const taskElement = document.createElement("div");
                taskElement.className = `task-item ${task.completed ? 'completed' : ''} ${task.type || ''}`;
                taskElement.setAttribute("role", "listitem");
                taskElement.setAttribute("aria-label", `Task: ${task.title}, ${task.completed ? 'completed' : 'not completed'}`);
                taskElement.innerHTML = `
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" role="checkbox" aria-checked="${task.completed}" aria-label="Toggle task completion" tabindex="0"></div>
                    <div class="task-content">
                        <div class="task-title">${sanitizeHTML(task.title)}</div>
                        <div class="task-meta">
                            <span class="task-time">${sanitizeHTML(task.time)}</span>
                            <span class="task-duration">${task.duration} min</span>
                            <span class="fa-icon"><i class="${sanitizeHTML(task.iconClass)}"></i></span>
                        </div>
                        <div>${sanitizeHTML(task.description)}</div>
                    </div>
                    <button class="btn btn-small btn-secondary" aria-label="Remove task">Remove</button>
                `;
                fragment.appendChild(taskElement);
            });
            tasksList.appendChild(fragment);
            tasksList.querySelectorAll(".task-checkbox").forEach((checkbox, i) => {
                checkbox.addEventListener("click", () => toggleTask(state.tasks[i].id));
                checkbox.addEventListener("keydown", (e) => {
                    if (e.key === "Enter" || e.key === " ") {
                        e.preventDefault();
                        toggleTask(state.tasks[i].id);
                    }
                });
            });
            tasksList.querySelectorAll(".btn-secondary").forEach((button, i) => {
                button.addEventListener("click", () => deleteTask(state.tasks[i].id));
            });
        } else {
            tasksList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon"><i class="fas fa-check-square"></i></div>
                    <div class="empty-title">No Tasks Yet</div>
                    <div class="empty-description">Create a schedule to generate your tasks! ðŸ“…</div>
                </div>
            `;
        }
    });
}

function addReminder() {
    const time = document.getElementById("reminderTime")?.value;
    const text = document.getElementById("reminderText")?.value.trim();

    if (!time || !text) {
        showNotification("Please enter both time and task description!", "error");
        return;
    }

    const bedtime = state.quizAnswers.bedtime ? parseTime(state.quizAnswers.bedtime) : null;
    if (bedtime) {
        const reminderTime = parseTime(time);
        if (reminderTime && reminderTime > bedtime) {
            showNotification("Reminder time cannot be after bedtime!", "error");
            return;
        }
    }

    const reminderId = `${time}-${text}-${Date.now()}`;
    const reminder = {
        id: reminderId,
        time,
        title: text,
        description: text,
        duration: 30,
        iconClass: inferTaskType(text) === "study" ? "fas fa-book" : inferTaskType(text) === "exercise" ? "fas fa-dumbbell" : inferTaskType(text) === "hobby" ? "fas fa-paint-brush" : "fas fa-bell",
        completed: false,
        type: inferTaskType(text)
    };

    state.reminders.push(reminder);
    state.tasks.push({ ...reminder });
    state.schedule.push({ ...reminder });
    state.reminders.sort((a, b) => {
        const timeA = parseTime(a.time) || new Date(0);
        const timeB = parseTime(b.time) || new Date(0);
        return timeA - timeB;
    });
    state.tasks.sort((a, b) => {
        const timeA = parseTime(a.time) || new Date(0);
        const timeB = parseTime(b.time) || new Date(0);
        return timeA - timeB;
    });
    state.schedule.sort((a, b) => {
        const timeA = parseTime(a.time) || new Date(0);
        const timeB = parseTime(b.time) || new Date(0);
        return timeA - timeB;
    });
    saveState();
    showNotification("Reminder added! ðŸ””");
    document.getElementById("reminderTime").value = "";
    document.getElementById("reminderText").value = "";
    renderReminders();
}

function deleteReminder(id) {
    const reminder = state.reminders.find(r => r.id === id);
    if (reminder) {
        state.reminders = state.reminders.filter(r => r.id !== id);
        state.tasks = state.tasks.filter(t => t.id !== id);
        state.schedule = state.schedule.filter(s => s.id !== id);
        saveState();
        showNotification("Reminder deleted! ðŸ—‘ï¸");
        renderReminders();
    }
}

function renderReminders() {
    console.log("Rendering reminders:", state.reminders);
    const remindersList = document.getElementById("remindersList");
    if (!remindersList) return;
    requestAnimationFrame(() => {
        remindersList.innerHTML = "";
        const fragment = document.createDocumentFragment();
        if (state.reminders.length) {
            state.reminders.forEach((reminder, index) => {
                const reminderElement = document.createElement("div");
                reminderElement.className = `task-item ${reminder.completed ? 'completed' : ''} ${reminder.type || ''}`;
                reminderElement.setAttribute("role", "listitem");
                reminderElement.setAttribute("aria-label", `Reminder: ${reminder.title}, ${reminder.completed ? 'completed' : 'not completed'}`);
                reminderElement.innerHTML = `
                    <div class="task-checkbox ${reminder.completed ? 'checked' : ''}" role="checkbox" aria-checked="${reminder.completed}" aria-label="Toggle reminder completion" tabindex="0"></div>
                    <div class="task-content">
                        <div class="task-title">${sanitizeHTML(reminder.title)}</div>
                        <div class="task-meta">
                            <span class="task-time">${sanitizeHTML(reminder.time)}</span>
                            <span class="task-duration">${reminder.duration} min</span>
                            <span class="fa-icon"><i class="${sanitizeHTML(reminder.iconClass)}"></i></span>
                        </div>
                        <div>${sanitizeHTML(reminder.description)}</div>
                    </div>
                    <button class="btn btn-small btn-secondary" aria-label="Remove reminder">Remove</button>
                `;
                fragment.appendChild(reminderElement);
            });
            remindersList.appendChild(fragment);
            remindersList.querySelectorAll(".task-checkbox").forEach((checkbox, i) => {
                checkbox.addEventListener("click", () => toggleTask(state.reminders[i].id));
                checkbox.addEventListener("keydown", (e) => {
                    if (e.key === "Enter" || e.key === " ") {
                        e.preventDefault();
                        toggleTask(state.reminders[i].id);
                    }
                });
            });
            remindersList.querySelectorAll(".btn-secondary").forEach((button, i) => {
                button.addEventListener("click", () => deleteReminder(state.reminders[i].id));
            });
        } else {
            remindersList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon"><i class="fas fa-bell"></i></div>
                    <div class="empty-title">No Reminders</div>
                    <div class="empty-description">Add some reminders to stay on track! ðŸ””</div>
                </div>
            `;
        }
    });
}

function renderProgress() {
    console.log("Rendering progress:", state.user, state.completedTasks);
    const totalStreak = document.getElementById("totalStreak");
    const totalTasksCompleted = document.getElementById("totalTasksCompleted");
    const totalXP = document.getElementById("totalXP");
    if (totalStreak) totalStreak.textContent = state.user.streak;
    if (totalTasksCompleted) totalTasksCompleted.textContent = state.completedTasks.length;
    if (totalXP) totalXP.textContent = state.user.xp;

    const completedTasksList = document.getElementById("completedTasksList");
    if (!completedTasksList) return;
    requestAnimationFrame(() => {
        completedTasksList.innerHTML = "";
        const fragment = document.createDocumentFragment();
        if (state.completedTasks.length) {
            state.completedTasks.forEach(task => {
                const taskElement = document.createElement("div");
                taskElement.className = "task-item completed";
                taskElement.setAttribute("role", "listitem");
                taskElement.setAttribute("aria-label", `Completed task: ${task.title}`);
                taskElement.innerHTML = `
                    <div class="task-checkbox checked" role="checkbox" aria-checked="true" aria-label="Completed task"></div>
                    <div class="task-content">
                        <div class="task-title">${sanitizeHTML(task.title)}</div>
                        <div class="task-meta">
                            <span class="task-time">${sanitizeHTML(task.time)}</span>
                            <span class="task-duration">${task.duration} min</span>
                            <span class="fa-icon"><i class="${sanitizeHTML(task.iconClass)}"></i></span>
                        </div>
                        <div>${sanitizeHTML(task.description)} (Completed: ${sanitizeHTML(task.completionDate)})</div>
                    </div>
                `;
                fragment.appendChild(taskElement);
            });
        } else {
            completedTasksList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon"><i class="fas fa-trophy"></i></div>
                    <div class="empty-title">No Completed Tasks</div>
                    <div class="empty-description">Complete some tasks to see your progress! ðŸ†</div>
                </div>
            `;
        }
        completedTasksList.appendChild(fragment);
    });
}

function changeAvatar() {
    const avatars = ["fas fa-bullseye", "fas fa-rocket", "fas fa-bolt", "fas fa-star", "fas fa-moon"];
    let currentIndex = avatars.indexOf(state.user.avatar);
    state.user.avatar = avatars[(currentIndex + 1) % avatars.length];
    saveState();
    showNotification("Avatar changed! ðŸ˜Ž");
    updateUI();
}

function saveHobbies() {
    const hobbiesInput = document.getElementById("hobbiesInput")?.value.trim();
    if (hobbiesInput) {
        state.user.hobbies = hobbiesInput.split(",").map(h => h.trim()).filter(h => h);
        document.getElementById("hobbiesInput").value = "";
        saveState();
        showNotification("Hobbies saved! ðŸŽ¨");
        renderHobbies();
    } else {
        showNotification("Please enter at least one hobby!", "error");
    }
}

function renderHobbies() {
    console.log("Rendering hobbies:", state.user.hobbies);
    const hobbiesList = document.getElementById("hobbiesList");
    if (!hobbiesList) return;
    requestAnimationFrame(() => {
        hobbiesList.innerHTML = "";
        const fragment = document.createDocumentFragment();
        if (state.user.hobbies.length) {
            state.user.hobbies.forEach(hobby => {
                const hobbyElement = document.createElement("div");
                hobbyElement.className = "task-item";
                hobbyElement.setAttribute("role", "listitem");
                hobbyElement.setAttribute("aria-label", `Hobby: ${hobby}`);
                hobbyElement.innerHTML = `
                    <div class="task-content">
                        <div class="task-title">${sanitizeHTML(hobby)}</div>
                        <div class="fa-icon"><i class="fas fa-paint-brush"></i></div>
                    </div>
                `;
                fragment.appendChild(hobbyElement);
            });
        } else {
            hobbiesList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon"><i class="fas fa-paint-brush"></i></div>
                    <div class="empty-title">No Hobbies Added</div>
                    <div class="empty-description">Add your hobbies to personalize your schedule! ðŸŽ¨</div>
                </div>
            `;
        }
        hobbiesList.appendChild(fragment);
    });
}

function toggleQuickAddForm() {
    const form = document.getElementById("quickAddForm");
    if (!form) return;
    form.classList.toggle("active");
    if (form.classList.contains("active")) {
        document.getElementById("quickTaskTime")?.focus();
    } else {
        document.getElementById("quickTaskTime").value = "";
        document.getElementById("quickTaskText").value = "";
    }
}

function addQuickTask() {
    const time = document.getElementById("quickTaskTime")?.value;
    const text = document.getElementById("quickTaskText")?.value.trim();

    if (!time || !text) {
        showNotification("Please enter both time and task description!", "error");
        return;
    }

    const bedtime = state.quizAnswers.bedtime ? parseTime(state.quizAnswers.bedtime) : null;
    if (bedtime) {
        const taskTime = parseTime(time);
        if (taskTime && taskTime > bedtime) {
            showNotification("Task time cannot be after bedtime!", "error");
            return;
        }
    }

    const taskId = `${time}-${text}-${Date.now()}`;
    const task = {
        id: taskId,
        time,
        title: text,
        description: text,
        duration: 30,
        iconClass: inferTaskType(text) === "study" ? "fas fa-book" : inferTaskType(text) === "exercise" ? "fas fa-dumbbell" : inferTaskType(text) === "hobby" ? "fas fa-paint-brush" : "fas fa-bell",
        completed: false,
        type: inferTaskType(text)
    };

    console.log("Adding task:", task);
    state.tasks.push(task);
    state.schedule.push(task);
    state.reminders.push({ ...task, id: `${time}-${text}-${Date.now()}` });
    state.tasks.sort((a, b) => {
        const timeA = parseTime(a.time) || new Date(0);
        const timeB = parseTime(b.time) || new Date(0);
        return timeA - timeB;
    });
    state.schedule.sort((a, b) => {
        const timeA = parseTime(a.time) || new Date(0);
        const timeB = parseTime(b.time) || new Date(0);
        return timeA - timeB;
    });
    state.reminders.sort((a, b) => {
        const timeA = parseTime(a.time) || new Date(0);
        const timeB = parseTime(b.time) || new Date(0);
        return timeA - timeB;
    });
    saveState();
    showNotification("Task added! âœ…");
    document.getElementById("quickTaskTime").value = "";
    document.getElementById("quickTaskText").value = "";
    toggleQuickAddForm();
    updateUI();
}

function updateUI() {
    console.log("Updating UI with state:", state);
    const welcomeName = document.getElementById("welcomeName");
    const welcomeAvatar = document.getElementById("welcomeAvatar");
    if (welcomeName) welcomeName.textContent = `Hello, ${sanitizeHTML(state.user.name)}!`;
    if (welcomeAvatar) welcomeAvatar.innerHTML = `<i class="${sanitizeHTML(state.user.avatar)}"></i>`;

    const dayStreak = document.getElementById("dayStreak");
    const tasksCompletedToday = document.getElementById("tasksCompletedToday");
    const studyTimeToday = document.getElementById("studyTimeToday");
    if (dayStreak) dayStreak.textContent = state.user.streak;
    if (tasksCompletedToday) tasksCompletedToday.textContent = state.stats.tasksCompletedToday;
    if (studyTimeToday) studyTimeToday.textContent = state.stats.studyTimeToday.toFixed(1);

    const progressRing = document.getElementById("progressRing");
    if (progressRing) {
        const xpProgress = (state.user.xp % 100) / 100;
        const circumference = 264;
        progressRing.style.strokeDashoffset = circumference * (1 - xpProgress);
    }

    const todaySchedule = document.getElementById("todaySchedule");
    if (todaySchedule) {
        requestAnimationFrame(() => {
            todaySchedule.innerHTML = "";
            const upcomingTasks = state.tasks.filter(task => !task.completed).slice(0, 5);
            const fragment = document.createDocumentFragment();
            if (upcomingTasks.length) {
                upcomingTasks.forEach((task, index) => {
                    const scheduleItem = document.createElement("div");
                    scheduleItem.className = "schedule-item";
                    scheduleItem.setAttribute("role", "listitem");
                    scheduleItem.setAttribute("aria-label", `Task: ${task.title}, ${task.completed ? 'completed' : 'not completed'}`);
                    scheduleItem.innerHTML = `
                        <div class="schedule-time">${sanitizeHTML(task.time)}</div>
                        <div class="schedule-dot"></div>
                        <div class="task-item ${task.completed ? 'completed' : ''} ${task.type || ''}">
                            <div class="task-checkbox ${task.completed ? 'checked' : ''}" role="checkbox" aria-checked="${task.completed}" aria-label="Toggle task completion" tabindex="0"></div>
                            <div class="task-content">
                                <div class="task-title">${sanitizeHTML(task.title)}</div>
                                <div class="task-meta">
                                    <span class="task-time">${sanitizeHTML(task.time)}</span>
                                    <span class="task-duration">${task.duration} min</span>
                                    <span class="fa-icon"><i class="${sanitizeHTML(task.iconClass)}"></i></span>
                                </div>
                                <div>${sanitizeHTML(task.description)}</div>
                            </div>
                        </div>
                    `;
                    fragment.appendChild(scheduleItem);
                });
                todaySchedule.appendChild(fragment);
                todaySchedule.querySelectorAll(".task-checkbox").forEach((checkbox, i) => {
                    checkbox.addEventListener("click", () => toggleTask(upcomingTasks[i].id));
                    checkbox.addEventListener("keydown", (e) => {
                        if (e.key === "Enter" || e.key === " ") {
                            e.preventDefault();
                            toggleTask(upcomingTasks[i].id);
                        }
                    });
                });
            } else {
                todaySchedule.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-calendar"></i></div>
                        <div class="empty-title">No Schedule Yet</div>
                        <div class="empty-description">Create your daily schedule to get started! ðŸ“…</div>
                        <button class="btn mt-2" aria-label="Create new schedule">Create Schedule</button>
                    </div>
                `;
                todayScheduleBtn = todaySchedule.querySelector("button.btn");
                if (todayScheduleBtn) {
                    todayScheduleBtn.addEventListener("click", () => navigateTo("scheduler"));
                }
            }
        });
    }

    const profileName = document.getElementById("profileName");
    const profileAvatar = document.createElement("div");
    const profileLevel = document.getElementById("profileLevel");
    const profileXP = document.createElement("div");
    const xpFill = document.getElementById("xpFill");
    const currentXP = document.createElement("span");
    const nextLevelXP = document.createElement("span");
    if (profileName) profileName.textContent = sanitizeHTML(state.user.name);
    if (xpFill) xpFill.style.width = `${(state.user.xp % 100)}%`;
    if (profileLevel) profileLevel.textContent = state.user.level;
    const profileSection = document.getElementById("profile");
    if (profileSection) {
        profileAvatar.id = "profileAvatar";
        profileAvatar.innerHTML = `<i class="${sanitizeHTML(state.user.avatar)}"></i>`;
        if (!document.getElementById("profileAvatar")) {
            profileSection.insertBefore(profileAvatar, profileSection.firstChild);
        }
        profileXP.id = "profileXP";
        profileXP.textContent = state.user.xp;
        if (!document.getElementById("profileXP")) {
            profileSection.appendChild(profileXP);
        }
        currentXP.id = "currentXP";
        currentXP.textContent = state.user.xp % 100;
        if (!document.getElementById("currentXP")) {
            profileSection.appendChild(currentXP);
        }
        nextLevelXP.id = "nextLevelXP";
        nextLevelXP.textContent = 100;
        if (!document.getElementById("nextLevelXP")) {
            profileSection.appendChild(nextLevelXP);
        }
    }
    const existingProfileAvatar = document.getElementById("profileAvatar");
    if (existingProfileAvatar) {
        existingProfileAvatar.addEventListener("click", changeAvatar);
    }

    renderTasks();
    renderReminders();
    renderProgress();
    renderHobbies();
    if (document.getElementById("scheduler")?.classList.contains("active")) {
        renderQuiz();
        const quizStepsContainer = document.getElementById("quizSteps");
        const schedulePreview = document.getElementById("schedulePreview");
        if (state.tasks.length === 0 && quizStepsContainer && schedulePreview) {
            quizStepsContainer.classList.remove("hidden");
            schedulePreview.classList.add("hidden");
            const prevBtn = document.getElementById("prevBtn");
            const nextBtn = document.getElementById("nextBtn");
            if (prevBtn) prevBtn.style.display = "inline-flex";
            if (nextBtn) nextBtn.style.display = "inline-flex";
        }
    }
}

function initialize() {
    console.log("Initializing app");
    loadState();
    initializeNavigation();
    initializeThemeSelector();
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const saveScheduleBtn = document.getElementById("schedulePreview")?.querySelector("button");
    const addReminderBtn = document.getElementById("reminders")?.querySelector(".btn");
    const profileAvatar = document.getElementById("profileAvatar");
    const welcomeAvatar = document.getElementById("welcomeAvatar");
    const saveHobbiesBtn = document.getElementById("profile")?.querySelector(".btn");
    const toggleQuickAddBtn = document.getElementById("quickAddForm")?.parentElement.querySelector(".btn-small");
    const addQuickTaskBtn = document.getElementById("quickAddForm")?.querySelector(".btn");
    const cancelQuickTaskBtn = document.getElementById("quickAddForm")?.querySelector(".btn-secondary");

    if (prevBtn) prevBtn.addEventListener("click", prevStep);
    if (nextBtn) nextBtn.addEventListener("click", nextStep);
    if (saveScheduleBtn) saveScheduleBtn.addEventListener("click", saveSchedule);
    if (addReminderBtn) addReminderBtn.addEventListener("click", addReminder);
    if (profileAvatar) profileAvatar.addEventListener("click", changeAvatar);
    if (welcomeAvatar) welcomeAvatar.addEventListener("click", () => navigateTo("profile"));
    if (saveHobbiesBtn) saveHobbiesBtn.addEventListener("click", saveHobbies);
    if (toggleQuickAddBtn) toggleQuickAddBtn.addEventListener("click", toggleQuickAddForm);
    if (addQuickTaskBtn) addQuickTaskBtn.addEventListener("click", addQuickTask);
    if (cancelQuickTaskBtn) cancelQuickTaskBtn.addEventListener("click", toggleQuickAddForm);

    updateUI();
}

document.addEventListener("DOMContentLoaded", initialize);
    </script>

    
</body>
</html>
