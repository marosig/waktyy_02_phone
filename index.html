<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyFlow - Complete Student Productivity App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --bg-card-hover: #252525;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-primary: #00d4aa;
            --accent-secondary: #6366f1;
            --accent-pink: #ec4899;
            --accent-orange: #f59e0b;
            --border: #333333;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        [data-theme="light"] {
            --bg-dark: #ffffff;
            --bg-card: #f8fafc;
            --bg-card-hover: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }

        [data-theme="white"] {
            --bg-dark: #fefefe;
            --bg-card: #ffffff;
            --bg-card-hover: #f9fafb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border: #e5e7eb;
        }

        [data-theme="neon"] {
            --bg-dark: #0f0f23;
            --bg-card: #1a1a2e;
            --bg-card-hover: #16213e;
            --text-primary: #eee6ff;
            --text-secondary: #9d8df1;
            --accent-primary: #00ffff;
            --accent-secondary: #ff00ff;
            --border: #3d3d5c;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0, 212, 170, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(236, 72, 153, 0.05) 0%, transparent 50%);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 430px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 60px 0 30px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-title {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite ease-in-out;
            letter-spacing: 1px;
        }

        .theme-selector {
            display: flex;
            gap: 8px;
        }

        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-btn.dark { background: #0a0a0a; }
        .theme-btn.light { background: #ffffff; }
        .theme-btn.white { background: #fefefe; }
        .theme-btn.neon { background: linear-gradient(45deg, #00ffff, #ff00ff); }

        .theme-btn.active {
            border-color: var(--accent-primary);
            transform: scale(1.1);
        }

        .card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-primary);
            box-shadow: 0 15px 40px rgba(0, 212, 170, 0.2);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-item {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 20px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .task-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 18px 0 0 18px;
        }

        .task-item:hover::before {
            opacity: 1;
        }

        .task-item.completed {
            opacity: 0.7;
            background: var(--bg-card-hover);
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
        }

        .task-item.completed::before {
            background: var(--success);
            opacity: 1;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
        }

        .task-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
            line-height: 1.3;
        }

        .task-meta {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-time {
            font-weight: 500;
        }

        .task-duration {
            background: rgba(0, 212, 170, 0.1);
            color: var(--accent-primary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .task-emoji {
            font-size: 24px;
            margin-top: -2px;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 5px 20px rgba(0, 212, 170, 0.2);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
        }

        .quiz-container {
            max-width: 100%;
        }

        .quiz-progress {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: var(--accent-primary);
            transform: scale(1.2);
        }

        .progress-dot.completed {
            background: var(--success);
        }

        .quiz-step {
            display: none;
        }

        .quiz-step.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .schedule-timeline {
            position: relative;
        }

        .schedule-timeline::before {
            content: '';
            position: absolute;
            left: 35px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .schedule-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 80px;
        }

        .schedule-time {
            position: absolute;
            left: 0;
            top: 0;
            width: 60px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-align: right;
        }

        .schedule-dot {
            position: absolute;
            left: 26px;
            top: 8px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-primary);
            border: 3px solid var(--bg-dark);
        }

        .navigation {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border-radius: 25px 25px 0 0;
            padding: 8px 0 16px;
            width: 100%;
            max-width: 430px;
            border: 1px solid var(--border);
            border-bottom: none;
            backdrop-filter: blur(20px);
            z-index: 1000;
        }

        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 6px;
            border-radius: 12px;
            min-width: 36px;
        }

        .nav-item.active {
            background: rgba(0, 212, 170, 0.1);
        }

        .nav-icon {
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .nav-item.active .nav-icon {
            color: var(--accent-primary);
            transform: scale(1.1);
        }

        .content {
            padding-bottom: 120px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px 20px;
            max-width: 300px;
            z-index: 1001;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.success {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .notification.error {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .empty-description {
            font-size: 14px;
            line-height: 1.5;
        }

        .profile-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin: 0 auto 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.3);
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .profile-level {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .profile-xp {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid var(--border);
        }

        .xp-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.5s ease;
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 15px;
            }
            
            .stats-grid {
                gap: 10px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 20px;
            }
        }

        .text-center { text-align: center; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none; }
        .flex { display: flex; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .gap-10 { gap: 10px; }
        .gap-15 { gap: 15px; }
    </style>
</head>
<body data-theme="dark">
    <div class="container">
        <div class="content">
            <!-- HOME PAGE -->
            <div id="home" class="page active">
                <div class="header">
                    <div class="app-title">Waktyy</div>
                </div>
                <div class="card">
                    <div class="profile-section">
                        <div class="profile-avatar" id="welcomeAvatar">üéØ</div>
                        <div class="profile-name" id="welcomeName">Hello, Student!</div>
                        <div class="profile-level">Ready to crush today's goals? üöÄ</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="dayStreak">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="tasksCompletedToday">0</div>
                        <div class="stat-label">Tasks Done</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="studyTimeToday">0</div>
                        <div class="stat-label">Study Hours</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Today's Schedule</h3>
                    <div id="todaySchedule" class="task-list">
                        <div class="empty-state">
                            <div class="empty-icon">üìÖ</div>
                            <div class="empty-title">No Schedule Yet</div>
                            <div class="empty-description">Create your daily schedule to get started!</div>
                            <button class="btn mt-20" onclick="navigateTo('scheduler')">Create Schedule</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SCHEDULER PAGE -->
            <div id="scheduler" class="page">
                <div class="header">
                    <div class="page-title">Create Schedule</div>
                </div>

                <div class="quiz-container">
                    <div class="quiz-progress" id="quizProgress"></div>
                    
                    <div class="card">
                        <div id="quizSteps"></div>
                        
                        <div class="quiz-navigation">
                            <button class="btn btn-secondary" id="prevBtn" onclick="prevStep()" style="display: none;">Back</button>
                            <button class="btn" id="nextBtn" onclick="nextStep()">Next</button>
                        </div>
                    </div>
                </div>

                <div id="schedulePreview" class="card hidden">
                    <h3 style="margin-bottom: 20px;">Your Generated Schedule</h3>
                    <div id="scheduleDisplay" class="schedule-timeline"></div>
                    <button class="btn mt-20" onclick="saveSchedule()">Save Schedule</button>
                </div>
            </div>

            <!-- TASKS PAGE -->
            <div id="tasks" class="page">
                <div class="header">
                    <div class="page-title">Tasks</div>
                </div>

                <div class="card">
                    <div id="tasksList" class="task-list">
                        <div class="empty-state">
                            <div class="empty-icon">‚úÖ</div>
                            <div class="empty-title">No Tasks Yet</div>
                            <div class="empty-description">Create a schedule to generate your tasks!</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REMINDERS PAGE -->
            <div id="reminders" class="page">
                <div class="header">
                    <div class="page-title">Reminders</div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Add Custom Reminder</h3>
                    <div class="form-group">
                        <label class="form-label">Time</label>
                        <input type="time" class="form-input" id="reminderTime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Task Description</label>
                        <input type="text" class="form-input" id="reminderText" placeholder="What do you need to remember?">
                    </div>
                    <button class="btn" onclick="addReminder()">Add Reminder</button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Your Reminders</h3>
                    <div id="remindersList" class="task-list">
                        <div class="empty-state">
                            <div class="empty-icon">üîî</div>
                            <div class="empty-title">No Reminders</div>
                            <div class="empty-description">Add some reminders to stay on track!</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PROGRESS PAGE -->
            <div id="progress" class="page">
                <div class="header">
                    <div class="page-title">Progress</div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalStreak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalTasksCompleted">0</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalXP">0</div>
                        <div class="stat-label">Total XP</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Completed Tasks</h3>
                    <div id="completedTasksList" class="task-list">
                        <div class="empty-state">
                            <div class="empty-icon">üèÜ</div>
                            <div class="empty-title">No Completed Tasks</div>
                            <div class="empty-description">Complete some tasks to see your progress!</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PROFILE PAGE -->
            <div id="profile" class="page">
                <div class="header">
                    <div class="page-title">Profile</div>
                    <div class="theme-selector">
                        <div class="theme-btn dark active" data-theme="dark" aria-label="Dark Theme"></div>
                        <div class="theme-btn light" data-theme="light" aria-label="Light Theme"></div>
                        <div class="theme-btn white" data-theme="white" aria-label="White Theme"></div>
                        <div class="theme-btn neon" data-theme="neon" aria-label="Neon Theme"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="profile-section">
                        <div class="profile-avatar" id="profileAvatar" onclick="changeAvatar()">üéØ</div>
                        <div class="profile-name" id="profileName">Student</div>
                        <div class="profile-level">
                            Level <span id="profileLevel">1</span> ‚Ä¢ <span id="profileXP">0</span> XP
                        </div>
                        <div class="profile-xp">
                            <div>XP Progress</div>
                            <div class="xp-bar">
                                <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                                <span id="currentXP">0</span> / <span id="nextLevelXP">100</span> XP
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Your Hobbies</h3>
                    <div class="form-group">
                        <label class="form-label">Add Hobbies (comma-separated)</label>
                        <input type="text" class="form-input" id="hobbiesInput" placeholder="Reading, Gaming, Music...">
                    </div>
                    <button class="btn" onclick="saveHobbies()">Save Hobbies</button>
                    
                    <div id="hobbiesList" class="mt-20">
                        <div class="empty-state">
                            <div class="empty-icon">üé®</div>
                            <div class="empty-title">No Hobbies Added</div>
                            <div class="empty-description">Add your hobbies to personalize your schedule!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-items">
                <div class="nav-item active" onclick="navigateTo('home')" aria-label="Home" aria-current="page">
                    <div class="nav-icon">üè†</div>
                </div>
                <div class="nav-item" onclick="navigateTo('scheduler')" aria-label="Scheduler">
                    <div class="nav-icon">üìÖ</div>
                </div>
                <div class="nav-item" onclick="navigateTo('tasks')" aria-label="Tasks">
                    <div class="nav-icon">‚úÖ</div>
                </div>
                <div class="nav-item" onclick="navigateTo('reminders')" aria-label="Reminders">
                    <div class="nav-icon">üîî</div>
                </div>
                <div class="nav-item" onclick="navigateTo('progress')" aria-label="Progress">
                    <div class="nav-icon">üìä</div>
                </div>
                <div class="nav-item" onclick="navigateTo('profile')" aria-label="Profile">
                    <div class="nav-icon">üë§</div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // State Management
        let state = {
            user: { name: "Student", avatar: "üéØ", level: 1, xp: 0, streak: 0, hobbies: [] },
            theme: "dark",
            schedule: [],
            tasks: [],
            reminders: [],
            completedTasks: [],
            stats: { tasksCompletedToday: 0, studyTimeToday: 0, lastReviewDate: null },
            quizAnswers: {},
            currentQuizStep: 0
        };

        const quizSteps = [
            { id: "name", question: "What's your name?", type: "text", required: true },
            { id: "timePreference", question: "Are you a morning person, night owl, or both?", type: "select", options: ["Morning", "Night", "Both"], required: true },
            { id: "schoolStart", question: "What time does your school start?", type: "time", required: true },
            { id: "schoolEnd", question: "What time does your school end?", type: "time", required: true },
            { id: "wakeUp", question: "What time do you wake up?", type: "time", required: true },
            { id: "bedtime", question: "What time do you go to bed?", type: "time", required: true },
            { id: "studyIntensity", question: "What's your study intensity?", type: "select", options: ["Chill", "Balanced", "Intense"], required: true },
            { id: "subjects", question: "What subjects are you studying? (comma-separated)", type: "text", required: true },
            { id: "exerciseType", question: "What type of exercise do you do?", type: "select", options: ["Running", "Yoga", "Gym", "Other"], required: true },
            { id: "exerciseDuration", question: "How long do you exercise? (minutes, min 30)", type: "number", min: 30, required: true },
            { id: "hobbies", question: "What are your hobbies? (comma-separated)", type: "text", required: true },
            { id: "hobbyDuration", question: "How long for hobbies? (minutes, min 60)", type: "number", min: 60, required: true },
            { id: "breakActivity", question: "What's your preferred break activity?", type: "select", options: ["Snack", "Nap", "Walk", "Other"], required: true },
            { id: "freeTimeActivity", question: "What do you do in your free time?", type: "select", options: ["Reading", "Netflix", "Gaming", "Other"], required: true }
        ];

        // Utility Functions
        function formatTime(date) {
            return date.toTimeString().slice(0, 5);
        }

        function parseTime(timeStr) {
            const [hours, minutes] = timeStr.split(":").map(Number);
            const date = new Date();
            date.setHours(hours, minutes, 0, 0);
            return date;
        }

        function addMinutes(time, minutes) {
            try {
                const date = parseTime(time);
                date.setMinutes(date.getMinutes() + minutes);
                return formatTime(date);
            } catch (e) {
                showNotification("Invalid time calculation!", "error");
                return time;
            }
        }

        function showNotification(message, type = "success") {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            clearTimeout(notification.timeout);
            notification.timeout = setTimeout(() => {
                notification.className = "notification";
            }, 3000);
        }

        function saveState() {
            try {
                localStorage.setItem("studyFlowState", JSON.stringify(state));
            } catch (e) {
                showNotification("Failed to save data!", "error");
            }
        }

        function loadState() {
            try {
                const savedState = localStorage.getItem("studyFlowState");
                if (savedState) {
                    state = JSON.parse(savedState);
                    applyTheme();
                    updateUI();
                }
            } catch (e) {
                showNotification("Failed to load data!", "error");
            }
        }

        function resetDaily() {
            const today = new Date().toDateString();
            if (state.stats.lastReviewDate !== today) {
                const completedToday = state.tasks.some(task => task.completed);
                state.tasks = state.tasks.filter(task => !task.completed);
                state.reminders = state.reminders.filter(reminder => !reminder.completed);
                state.stats.tasksCompletedToday = 0;
                state.stats.studyTimeToday = 0;
                state.stats.lastReviewDate = today;
                if (completedToday) {
                    state.user.streak++;
                    showNotification("Streak increased!");
                } else if (state.tasks.length === 0) {
                    state.user.streak = 0;
                }
                saveState();
                updateUI();
            }
        }

        // Theme Management
        function applyTheme() {
            document.body.setAttribute("data-theme", state.theme);
            document.querySelectorAll(".theme-btn").forEach(btn => {
                btn.classList.toggle("active", btn.getAttribute("data-theme") === state.theme);
            });
        }

        document.querySelectorAll(".theme-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                state.theme = btn.getAttribute("data-theme");
                applyTheme();
                saveState();
                showNotification(`Theme changed to ${state.theme}!`);
            });
        });

        // Navigation
        function navigateTo(pageId) {
            document.querySelectorAll(".page").forEach(page => page.classList.remove("active"));
            document.getElementById(pageId).classList.add("active");
            document.querySelectorAll(".nav-item").forEach(item => {
                item.classList.toggle("active", item.getAttribute("onclick").includes(pageId));
                if (item.getAttribute("onclick").includes(pageId)) {
                    item.setAttribute("aria-current", "page");
                } else {
                    item.removeAttribute("aria-current");
                }
            });
            resetDaily();
            updateUI();
        }

        // Quiz Management
        function renderQuiz() {
            const quizStepsContainer = document.getElementById("quizSteps");
            quizStepsContainer.innerHTML = quizSteps.map((step, index) => `
                <div class="quiz-step ${index === state.currentQuizStep ? 'active' : ''}" data-step="${index}">
                    <div class="form-group">
                        <label class="form-label">${step.question}</label>
                        ${step.type === "text" ? `<input type="text" class="form-input" id="${step.id}" value="${state.quizAnswers[step.id] || ''}" ${step.required ? 'required' : ''}>` :
                         step.type === "number" ? `<input type="number" class="form-input" id="${step.id}" value="${state.quizAnswers[step.id] || ''}" min="${step.min || 0}" ${step.required ? 'required' : ''}>` :
                         step.type === "time" ? `<input type="time" class="form-input" id="${step.id}" value="${state.quizAnswers[step.id] || ''}" ${step.required ? 'required' : ''}>` :
                         `<select class="form-select" id="${step.id}" ${step.required ? 'required' : ''}>
                            <option value="">Select...</option>
                            ${step.options.map(opt => `<option value="${opt}" ${state.quizAnswers[step.id] === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                          </select>`}
                    </div>
                </div>
            `).join('');

            const quizProgress = document.getElementById("quizProgress");
            quizProgress.innerHTML = quizSteps.map((_, index) => `
                <div class="progress-dot ${index === state.currentQuizStep ? 'active' : index < state.currentQuizStep ? 'completed' : ''}"></div>
            `).join('');

            document.getElementById("prevBtn").style.display = state.currentQuizStep === 0 ? "none" : "inline-flex";
            document.getElementById("nextBtn").textContent = state.currentQuizStep === quizSteps.length - 1 ? "Finish" : "Next";
        }

        function validateStep(stepIndex) {
            const step = quizSteps[stepIndex];
            const input = document.getElementById(step.id);
            const value = input.value.trim();

            if (step.required && !value) {
                showNotification(`${step.question} is required!`, "error");
                return false;
            }

            if (step.type === "number" && value && parseInt(value) < step.min) {
                showNotification(`Minimum value for ${step.question} is ${step.min}!`, "error");
                return false;
            }

            if (step.id === "schoolEnd" && state.quizAnswers.schoolStart) {
                const start = parseTime(state.quizAnswers.schoolStart);
                const end = parseTime(value);
                if (end <= start) {
                    showNotification("School end time must be after start time!", "error");
                    return false;
                }
            }

            if (step.id === "bedtime" && state.quizAnswers.wakeUp) {
                const wakeUp = parseTime(state.quizAnswers.wakeUp);
                const bedtime = parseTime(value);
                if (bedtime <= wakeUp) {
                    showNotification("Bedtime must be after wake-up time!", "error");
                    return false;
                }
            }

            return true;
        }

        function prevStep() {
            if (state.currentQuizStep > 0) {
                state.currentQuizStep--;
                renderQuiz();
            }
        }

        function nextStep() {
            const currentStep = quizSteps[state.currentQuizStep];
            const input = document.getElementById(currentStep.id);
            state.quizAnswers[currentStep.id] = input.value.trim();

            if (!validateStep(state.currentQuizStep)) return;

            if (state.currentQuizStep < quizSteps.length - 1) {
                state.currentQuizStep++;
                renderQuiz();
            } else {
                generateSchedule();
                document.getElementById("quizSteps").classList.add("hidden");
                document.getElementById("quizProgress").classList.add("hidden");
                document.getElementById("prevBtn").style.display = "none";
                document.getElementById("nextBtn").style.display = "none";
                document.getElementById("schedulePreview").classList.remove("hidden");
            }
        }

        function generateSchedule() {
            const { wakeUp, bedtime, schoolStart, schoolEnd, subjects, studyIntensity, exerciseType, exerciseDuration, hobbies, hobbyDuration, breakActivity, freeTimeActivity, timePreference } = state.quizAnswers;
            state.schedule = [];

            let currentTime = wakeUp;
            state.schedule.push({ time: currentTime, title: "Wake Up", description: "Start your day!", duration: 0, emoji: "‚òÄÔ∏è", completed: false });

            currentTime = addMinutes(currentTime, 30);
            state.schedule.push({ time: currentTime, title: "Morning Routine", description: "Get ready for the day", duration: 30, emoji: "ü™•", completed: false });

            if (timePreference === "Morning" || timePreference === "Both") {
                state.schedule.push({ time: currentTime, title: `Exercise: ${exerciseType}`, description: `Time for ${exerciseType.toLowerCase()}`, duration: parseInt(exerciseDuration), emoji: "üí™", completed: false });
                currentTime = addMinutes(currentTime, parseInt(exerciseDuration));
            }

            if (parseTime(currentTime) < parseTime(schoolStart)) {
                state.schedule.push({ time: currentTime, title: "Free Time", description: freeTimeActivity, duration: 45, emoji: "üéâ", completed: false });
                currentTime = schoolStart;
            }

            state.schedule.push({ time: currentTime, title: "School", description: "Attend classes", duration: Math.round((parseTime(schoolEnd) - parseTime(schoolStart)) / 60000), emoji: "üè´", completed: false });
            currentTime = schoolEnd;

            state.schedule.push({ time: currentTime, title: "Lunch Break", description: "Enjoy your meal", duration: 45, emoji: "üçΩÔ∏è", completed: false });
            currentTime = addMinutes(currentTime, 45);

            const subjectsList = subjects.split(",").map(s => s.trim()).filter(s => s);
            const studyDuration = studyIntensity === "Chill" ? 30 : studyIntensity === "Balanced" ? 45 : 60;
            subjectsList.forEach(subject => {
                state.schedule.push({ time: currentTime, title: `Study: ${subject}`, description: `Focus on ${subject}`, duration: studyDuration, emoji: "üìö", completed: false });
                currentTime = addMinutes(currentTime, studyDuration);
                state.schedule.push({ time: currentTime, title: breakActivity, description: "Take a short break", duration: 10, emoji: "‚òï", completed: false });
                currentTime = addMinutes(currentTime, 10);
            });

            if (timePreference === "Night" || timePreference === "Both") {
                state.schedule.push({ time: currentTime, title: `Exercise: ${exerciseType}`, description: `Time for ${exerciseType.toLowerCase()}`, duration: parseInt(exerciseDuration), emoji: "üí™", completed: false });
                currentTime = addMinutes(currentTime, parseInt(exerciseDuration));
            }

            const hobbiesList = hobbies.split(",").map(h => h.trim()).filter(h => h);
            state.schedule.push({ time: currentTime, title: "Hobbies", description: `Enjoy ${hobbiesList.join(", ")}`, duration: parseInt(hobbyDuration), emoji: "üé®", completed: false });
            currentTime = addMinutes(currentTime, parseInt(hobbyDuration));

            state.schedule.push({ time: currentTime, title: "Free Time", description: freeTimeActivity, duration: 45, emoji: "üéâ", completed: false });
            currentTime = addMinutes(currentTime, 45);

            state.schedule.push({ time: bedtime, title: "Bedtime", description: "Get some rest", duration: 0, emoji: "üõå", completed: false });

            state.schedule.sort((a, b) => parseTime(a.time) - parseTime(b.time));
            renderSchedule();
        }

        function renderSchedule() {
            const scheduleDisplay = document.getElementById("scheduleDisplay");
            scheduleDisplay.innerHTML = state.schedule.map(item => `
                <div class="schedule-item">
                    <div class="schedule-time">${item.time}</div>
                    <div class="schedule-dot"></div>
                    <div class="task-item ${item.completed ? 'completed' : ''}">
                        <div class="task-checkbox ${item.completed ? 'checked' : ''}" onclick="toggleTask('${item.time}', '${item.title}')"></div>
                        <div class="task-content">
                            <div class="task-title">${item.title}</div>
                            <div class="task-meta">
                                <span class="task-time">${item.time}</span>
                                <span class="task-duration">${item.duration} min</span>
                                <span class="task-emoji">${item.emoji}</span>
                            </div>
                            <div>${item.description}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function saveSchedule() {
            state.tasks = state.schedule.map(item => ({ ...item, type: inferTaskType(item.title) }));
            state.reminders = state.tasks.map(task => ({ ...task, id: `${task.time}-${task.title}` }));
            state.user.hobbies = state.quizAnswers.hobbies ? state.quizAnswers.hobbies.split(",").map(h => h.trim()).filter(h => h) : [];
            state.user.name = state.quizAnswers.name || "Student";
            state.currentQuizStep = 0;
            state.quizAnswers = {};
            saveState();
            showNotification("Schedule saved successfully!");
            navigateTo("home");
        }

        // Task Management
        function inferTaskType(title) {
            if (title.toLowerCase().includes("study")) return "study";
            if (title.toLowerCase().includes("exercise")) return "exercise";
            if (title.toLowerCase().includes("hobbies")) return "hobby";
            if (title.toLowerCase().includes("break") || title.toLowerCase().includes("lunch")) return "break";
            if (title.toLowerCase().includes("free time")) return "free";
            return "custom";
        }

        function toggleTask(time, title) {
            const task = state.tasks.find(t => t.time === time && t.title === title);
            const reminder = state.reminders.find(r => r.time === time && r.title === title);
            const scheduleItem = state.schedule.find(s => s.time === time && s.title === title);

            if (task && scheduleItem) {
                task.completed = !task.completed;
                scheduleItem.completed = task.completed;
                if (reminder) reminder.completed = task.completed;

                if (task.completed) {
                    state.stats.tasksCompletedToday++;
                    if (task.type === "study") state.stats.studyTimeToday += task.duration / 60;
                    state.user.xp += 10;
                    state.completedTasks.push({ ...task, completionDate: new Date().toDateString() });
                    if (state.completedTasks.length > 20) state.completedTasks.shift();
                    if (state.tasks.every(t => t.completed)) {
                        state.user.streak++;
                        state.stats.tasksCompletedToday = 15;
                        state.tasks = [];
                        state.reminders = [];
                        state.schedule = [];
                        showNotification("All tasks completed! Streak increased!");
                    } else {
                        showNotification("Task completed! +10 XP");
                    }
                } else {
                    state.stats.tasksCompletedToday = Math.max(0, state.stats.tasksCompletedToday - 1);
                    if (task.type === "study") state.stats.studyTimeToday = Math.max(0, state.stats.studyTimeToday - task.duration / 60);
                    state.user.xp = Math.max(0, state.user.xp - 10);
                    state.completedTasks = state.completedTasks.filter(t => !(t.time === time && t.title === title));
                    showNotification("Task unmarked.");
                }

                state.user.level = Math.floor(state.user.xp / 100) + 1;
                if (state.user.level > 1 && state.user.xp % 100 === 0) {
                    showNotification(`Level up! You are now Level ${state.user.level}!`);
                }
                saveState();
                updateUI();
            }
        }

        function renderTasks() {
            const tasksList = document.getElementById("tasksList");
            tasksList.innerHTML = state.tasks.length ? state.tasks.map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''}">
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask('${task.time}', '${task.title}')"></div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span class="task-time">${task.time}</span>
                            <span class="task-duration">${task.duration} min</span>
                            <span class="task-emoji">${task.emoji}</span>
                        </div>
                        <div>${task.description}</div>
                    </div>
                </div>
            `).join('') : `
                <div class="empty-state">
                    <div class="empty-icon">‚úÖ</div>
                    <div class="empty-title">No Tasks Yet</div>
                    <div class="empty-description">Create a schedule to generate your tasks!</div>
                </div>
            `;
        }

        // Reminder Management
        function addReminder() {
            const time = document.getElementById("reminderTime").value;
            const text = document.getElementById("reminderText").value.trim();

            if (!time || !text) {
                showNotification("Please enter both time and task description!", "error");
                return;
            }

            const reminder = {
                id: `${time}-${text}`,
                time,
                title: text,
                description: text,
                duration: 30,
                emoji: inferTaskType(text) === "study" ? "üìö" : inferTaskType(text) === "exercise" ? "üí™" : inferTaskType(text) === "hobby" ? "üé®" : "üîî",
                completed: false,
                type: inferTaskType(text)
            };

            state.reminders.push(reminder);
            state.tasks.push({ ...reminder });
            state.reminders.sort((a, b) => parseTime(a.time) - parseTime(b.time));
            state.tasks.sort((a, b) => parseTime(a.time) - parseTime(b.time));
            saveState();
            showNotification("Reminder added!");
            document.getElementById("reminderTime").value = "";
            document.getElementById("reminderText").value = "";
            renderReminders();
        }

        function deleteReminder(id) {
            const reminder = state.reminders.find(r => r.id === id);
            if (reminder) {
                state.reminders = state.reminders.filter(r => r.id !== id);
                state.tasks = state.tasks.filter(t => !(t.time === reminder.time && t.title === reminder.title));
                saveState();
                showNotification("Reminder deleted!");
                renderReminders();
            }
        }

        function renderReminders() {
            const remindersList = document.getElementById("remindersList");
            remindersList.innerHTML = state.reminders.length ? state.reminders.map(reminder => `
                <div class="task-item ${reminder.completed ? 'completed' : ''}">
                    <div class="task-checkbox ${reminder.completed ? 'checked' : ''}" onclick="toggleTask('${reminder.time}', '${reminder.title}')"></div>
                    <div class="task-content">
                        <div class="task-title">${reminder.title}</div>
                        <div class="task-meta">
                            <span class="task-time">${reminder.time}</span>
                            <span class="task-duration">${reminder.duration} min</span>
                            <span class="task-emoji">${reminder.emoji}</span>
                        </div>
                        <div>${reminder.description}</div>
                    </div>
                    <button class="btn btn-small btn-secondary" onclick="deleteReminder('${reminder.id}')">Remove</button>
                </div>
            `).join('') : `
                <div class="empty-state">
                    <div class="empty-icon">üîî</div>
                    <div class="empty-title">No Reminders</div>
                    <div class="empty-description">Add some reminders to stay on track!</div>
                </div>
            `;
        }

        // Progress Management
        function renderProgress() {
            document.getElementById("totalStreak").textContent = state.user.streak;
            document.getElementById("totalTasksCompleted").textContent = state.completedTasks.length;
            document.getElementById("totalXP").textContent = state.user.xp;

            const completedTasksList = document.getElementById("completedTasksList");
            completedTasksList.innerHTML = state.completedTasks.length ? state.completedTasks.map(task => `
                <div class="task-item completed">
                    <div class="task-checkbox checked"></div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span class="task-time">${task.time}</span>
                            <span class="task-duration">${task.duration} min</span>
                            <span class="task-emoji">${task.emoji}</span>
                        </div>
                        <div>${task.description} (Completed: ${task.completionDate})</div>
                    </div>
                </div>
            `).join('') : `
                <div class="empty-state">
                    <div class="empty-icon">üèÜ</div>
                    <div class="empty-title">No Completed Tasks</div>
                    <div class="empty-description">Complete some tasks to see your progress!</div>
                </div>
            `;
        }

        // Profile Management
        function changeAvatar() {
            const avatars = ["üéØ", "üöÄ", "‚ö°"];
            let currentIndex = avatars.indexOf(state.user.avatar);
            state.user.avatar = avatars[(currentIndex + 1) % avatars.length];
            saveState();
            showNotification("Avatar changed!");
            updateUI();
        }

        function saveHobbies() {
            const hobbiesInput = document.getElementById("hobbiesInput").value.trim();
            if (hobbiesInput) {
                state.user.hobbies = hobbiesInput.split(",").map(h => h.trim()).filter(h => h);
                document.getElementById("hobbiesInput").value = "";
                saveState();
                showNotification("Hobbies saved!");
                renderHobbies();
            } else {
                showNotification("Please enter at least one hobby!", "error");
            }
        }

        function renderHobbies() {
            const hobbiesList = document.getElementById("hobbiesList");
            hobbiesList.innerHTML = state.user.hobbies.length ? state.user.hobbies.map(hobby => `
                <div class="task-item">
                    <div class="task-content">
                        <div class="task-title">${hobby}</div>
                        <div class="task-emoji">üé®</div>
                    </div>
                </div>
            `).join('') : `
                <div class="empty-state">
                    <div class="empty-icon">üé®</div>
                    <div class="empty-title">No Hobbies Added</div>
                    <div class="empty-description">Add your hobbies to personalize your schedule!</div>
                </div>
            `;
        }

        // UI Updates
        function updateUI() {
            // Home Page
            document.getElementById("welcomeName").textContent = `Hello, ${state.user.name}!`;
            document.getElementById("welcomeAvatar").textContent = state.user.avatar;
            document.getElementById("dayStreak").textContent = state.user.streak;
            document.getElementById("tasksCompletedToday").textContent = state.stats.tasksCompletedToday;
            document.getElementById("studyTimeToday").textContent = state.stats.studyTimeToday.toFixed(1);

            const todaySchedule = document.getElementById("todaySchedule");
            const upcomingTasks = state.tasks.filter(task => !task.completed).slice(0, 3);
            todaySchedule.innerHTML = upcomingTasks.length ? upcomingTasks.map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''}">
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask('${task.time}', '${task.title}')"></div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span class="task-time">${task.time}</span>
                            <span class="task-duration">${task.duration} min</span>
                            <span class="task-emoji">${task.emoji}</span>
                        </div>
                        <div>${task.description}</div>
                    </div>
                </div>
            `).join('') : `
                <div class="empty-state">
                    <div class="empty-icon">üìÖ</div>
                    <div class="empty-title">No Schedule Yet</div>
                    <div class="empty-description">Create your daily schedule to get started!</div>
                    <button class="btn mt-20" onclick="navigateTo('scheduler')">Create Schedule</button>
                </div>
            `;

            // Profile Page
            document.getElementById("profileName").textContent = state.user.name;
            document.getElementById("profileAvatar").textContent = state.user.avatar;
            document.getElementById("profileLevel").textContent = state.user.level;
            document.getElementById("profileXP").textContent = state.user.xp;
            document.getElementById("currentXP").textContent = state.user.xp % 100;
            document.getElementById("nextLevelXP").textContent = 100;
            document.getElementById("xpFill").style.width = `${(state.user.xp % 100)}%`;

            renderTasks();
            renderReminders();
            renderProgress();
            renderHobbies();
        }

        // Initialize
        loadState();
        renderQuiz();
        updateUI();
    </script>
</body>
</html>
